(function(d){var c=function(f){AJS.log("InputDrivenDropDown: truncating text");var h=f.$.closest(".aui-dd-parent").width(),g=20;if(!h){f.$.width("25em");h=f.$.width()}d("a span:not(.icon)",f.$).each(function(){var j=d(this),i=AJS("var","&#8230;"),l=i.width(),k=false;j.wrapInner(d("<em>"));d("em",j).each(function(){var m=d(this);m.show();if(this.offsetLeft+this.offsetWidth+l>h-g){var t=this.childNodes,s=false;for(var o=t.length-1;o>=0;o--){var p=t[o],n=1,r=(p.nodeType==3)?"nodeValue":"innerHTML",q=p[r];do{if(n<=q.length){p[r]=q.substr(0,q.length-n++)}else{break}}while(this.offsetLeft+this.offsetWidth+l>h-g);if(n<=q.length){s=true;break}}if(s){k=true}else{m.hide()}}});if(k){j.append(i);this.elpss=i}})};var b=function(f){AJS.log("InputDrivenDropDown: add space names");d("a span:not(.icon)",f.$).each(function(){var i=d(this);var g;try{g=AJS.dropDown.getAdditionalPropertyValue(i,"spaceName")}catch(h){AJS.log("Problem getting space name: "+h.message)}var j=i.text();if(g){j+=" ("+AJS("i").html(g).text()+")"}i.attr("title",j)})};var e=function(k,g){var j=k.options,h=k.dd;if(h){h.hide();h.$.remove()}j.ajsDropDownOptions=j.ajsDropDownOptions||{};if(j.ajsDropDownOptions&&!j.ajsDropDownOptions.alignment){j.ajsDropDownOptions.alignment="left"}j.ajsDropDownOptions.selectionHandler=j.ajsDropDownOptions.selectionHandler||function(m,l){if(m.type!="click"){m.preventDefault();d("a",l).click();document.location=d("a",l).attr("href")}};var f=k.dd=AJS.dropDown(g.matrix,j.ajsDropDownOptions)[0];if(j.ajsDropDownOptions&&j.ajsDropDownOptions.className){f.$.addClass(j.ajsDropDownOptions.className)}if(j.dropdownPlacement){j.dropdownPlacement(f.$)}else{AJS.log("No dropdownPlacement function specified. Appending dropdown to the body.");d("body").append(f.$)}var i=new Confluence.Highlighter(g.queryTokens||[g.query]);d("li a:not(.dropdown-prevent-highlight) span",f.$).each(function(){var l=d(this);l.html(i.highlight(l.html(),true))});c(f);b(f);if(j.dropdownPostprocess){j.dropdownPostprocess(f.$)}f.show(k._effect);if(typeof j.onShow=="function"){j.onShow.call(f,f.$)}return f};function a(g,f){this._effect="appear";this._timer=null;this.id=g;this.options=f;this.inactive=false;this.busy=false;this.cacheManager=AJS.Confluence.cacheManager()}a.prototype.clearCache=function(){this.cacheManager.clear()};a.prototype.change=function(i,h){var g=this;if(i!=g._value){g._value=i;g.busy=false;clearTimeout(g._timer);if(h||(/\S{2,}/).test(i)){var j=g.cacheManager.get(i);if(j){e(g,j)}else{g.busy=true;var f=function(){g.options.getDataAndRunCallback.call(g,i,g.show)};if(g.options.dropDownDelay===0){f()}else{g._timer=setTimeout(function(){f()},g.options.dropDownDelay||200)}}}else{g.dd&&g.dd.hide()}}};a.prototype.hide=function(){this.dd&&this.dd.hide()};a.prototype.remove=function(){var f=this.dd;if(f){this.hide();f.$.remove()}this.inactive=true;this.options.onDeath&&this.options.onDeath()};a.prototype.show=function(g,i,h){if(this.inactive){AJS.log("Quick search abandoned before server response received, ignoring. "+this);return}var f={matrix:g,query:i,queryTokens:h};this.cacheManager.put(i,f);e(this,f);this.busy=false};AJS.inputDrivenDropdown=function(f){return new a("inputdriven-dropdown",f)}})(jQuery);