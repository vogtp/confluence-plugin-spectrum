(function(d){var b=function(h,j){var l=-11,g=d('<div class="aui-tip-parent"></div>');if(d.browser.msie&&d.browser.version<9){l=(parseInt(d.browser.version,10)<8)?-5:-13}var f=j?14:7;h.prepend(g).css({zIndex:3001});var i=Raphael(g[0],15,f),k=i.path("M0,6.0001l6.00001-6.00001,6.0001,6.0001").attr({fill:"#f0f0f0",stroke:"#e2e2e2"});i.canvas.style.zIndex=3000;tip=i;if(j){k.rotate(180);if(d.support.opacity){k.clone().translate(2,3).attr({fill:"#A0A0A0",stroke:"#A0A0A0",opacity:".5",blur:"1"}).toBack()}l=l+h.outerHeight()+10}g.css({top:l,left:10});return i},c=function(f,g){return Raphael.shadow(0,0,f.outerWidth(true),f.outerHeight(true),{radius:5,target:f[0],offset:2})},e=function(g,h,f,k){var i=f.outerHeight(),j=i+~~k,l=AJS.Position.spaceAboveBelow(g[0],h);if(l.below>=j){return false}return(l.above>=j)},a=function(g,f){f=f||{};setTimeout(function(){var k=AJS.Rte.Content.offset(g.anchor),p=g.panel.width()+k.left-d(window).width()+10,s=7,h=0,i=d(g.anchor).outerHeight(),o,j=k.left-(p>0?p:0)-h;if(g.shouldFlip){o=k.top-s-g.panel.outerHeight()-4}else{o=k.top+s+i}if(g.options.anchorIframe){var r=d(g.options.anchorIframe),n=r.offset().top+r.height()-g.panel.outerHeight()-10;o=Math.min(o,n)}g.panel.find(".aui-tip-parent").css({left:Math.abs(k.left-j)+10});j=Math.max(0,j);var m={top:o,left:j},q=g.panel.add(g.shadow),l=function(){if(g.shadow){g.shadow.css("left",g.panel.position().left-1)}};f.animate?q.animate(m,f.animateDuration,l):(function(){q.css(m);l()})()},f.delay||0)};AJS.Confluence.PropertyPanel={shouldCreate:true,current:null,createFromButtonModel:function(o,g,n,q){var f=AJS("div").attr({"class":"panel-buttons"});for(var k=0,p=n.length;k<p;k++){if(!n[k]){continue}var m=n[k],l=m.html||'<span class="icon"></span><span class="panel-button-text">'+(m.text||"")+"</span>",h=[];m.className&&h.push(m.className);m.disabled&&h.push("disabled");m.selected&&h.push("selected");!n[k+1]&&h.push("last");!n[k-1]&&h.push("first");var j;if(!m.html){j=AJS("a").attr({href:n[k].href||"#"}).html(l);if(m.disabled){j.attr("title",m.disabledText);j.disable();j.click(function(i){return AJS.stopEvent(i)})}else{n[k].click&&(function(r,i,s){i.click(function(t){r.click(i,s);return AJS.stopEvent(t)})})(n[k],j,g)}}else{j=d(m.html)}m.tooltip&&j.attr("title",m.tooltip);j.addClass(h.join(" "));f.append(j)}return this.create(o,g,f,q)},create:function(j,g,i,p){p=p||{};AJS.Rte.BookmarkManager.storeBookmark();var l=d("#property-panel"),f,n=p.enableFlip==undefined||p.enableFlip,o;l.length&&this.destroy();l=AJS("div").addClass("aui-property-panel-parent").addClass(j+"-panel").attr("id","property-panel").appendTo("body");f=AJS("div").addClass("aui-property-panel").append(i);l.append(f).css({top:0,left:-10000});o=n&&e(d(p.anchorIframe||d(g).parent()),d(g),l,10);var h=this;i.find(".last:last").css({margin:0});var m=c(l,o),k=b(l,o);this.current={anchor:g,panel:l,hasAnchorChanged:function(q){return q&&h.hasAnchorChanged(q)},snapToElement:function(q){a(this,q)},shouldFlip:o,shadow:m,tip:k,options:p,updating:true,type:j};a(this.current);f=this.current;AJS.$(document).bind("keydown.property-panel.escape",function(q){if(q.keyCode===27){AJS.Confluence.PropertyPanel.destroy()}});AJS.$(document).bind("click.property-panel",function(q){if(!AJS.$(q.target).closest("#property-panel").length){AJS.Confluence.PropertyPanel.destroy()}});AJS.trigger("created.property-panel",this.current);this.current.updating=false;return this.current},destroy:function(){if(!this.current){AJS.log("PropertyPanel.destroy: called with no current PropertyPanel, returning");return}if(this.current.updating){AJS.log("PropertyPanel.destroy: called while updating, returning");return}AJS.trigger("destroyed.property-panel",this.current);AJS.$(document).unbind(".property-panel").unbind(".contextToolbar");this.current.panel.remove();this.current.shadow&&this.current.shadow.remove();this.current=null},hasAnchorChanged:function(f){var g=this.current;if(g&&d(g.anchor)[0]==d(f)[0]){return(g.options.originalHeight&&(g.options.originalHeight!=d(f).height()))}return true}}})(AJS.$);