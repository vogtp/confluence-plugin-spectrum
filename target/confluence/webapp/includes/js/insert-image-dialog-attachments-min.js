AJS.toInit(function(e){var c,g,d,h=function(i){var j=function(){return e(".attachments-panel",i.baseElement)},m=function(){return e("#attached-images")},l=function(){return e(".image-list",m())},n=function(){return e("form",j())},k=function(p,q){q=q?e.map(q,function(r){return r&&r.toLowerCase()}):[];var o=m();o.find(".image-list").empty();AJS.getJSONWrap({url:"/pages/attachedimages.action",data:{contentId:i.attachmentSourceContentId},messageHandler:d,loadingElement:o.find(".loading-message"),errorMessage:AJS.I18n.getText("image.browser.error.retrieving.attachments"),successCallback:function(r){i.imageContainerSupport.refreshImageList(i,{imageContainer:o,images:r.images,noImageMessage:AJS.I18n.getText("image.browser.no.attachments"),justAttached:q,showParentTitle:false,displayErrors:function(s){g.displayErrors(s)}});AJS.Meta.set("num-attachments",+r.totalImages);e("#rte-button-attachments").trigger("updateLabel");p.trigger("afterThumbnail",[l()])}})};return{getPanelElement:j,getContainer:m,getForm:n,refreshWithLatestImages:k,getPanel:function(){var o=Confluence.Templates.Image.attachedImagesPanel();if(AJS.Meta.getBoolean("can-attach-files")){o=Confluence.Templates.Image.uploadFileForm()+o}return o},focus:function(){e("select.img-align",j()).focus()},upload:function(o){e.ajax({dataType:"json",data:{contentId:i.attachmentSourceContentId,responseFormat:"html"},resetForm:true,error:o.error,success:o.success})},getUploaderController:function(){var o=function(p){return{onUploadSuccess:function(q){b.refreshWithLatestImages(f,e.map(q||[],function(r){return r.name.toLowerCase()}))},pack:function(){m().sizeToFit()},getDefaultErrorMessage:function(){return AJS.I18n.getText("image.browser.upload.error")},getDefaultUploadingMessage:function(){return AJS.I18n.getText("image.browser.upload.image.uploading")},getUploadingMessageElement:function(){return e(".image-uploading",p.baseElement)}}};return Confluence.AttachmentUploader({baseElement:e("#upload-attachment",i.baseElement)},o)}}},b,a={id:"attachments",createPanel:function(j,i){b=(i&&i(j))||h(j),c=j.addPanel(AJS.I18n.getText("image.browser.attached.images.title"),b.getPanel(),"attachments-panel");g=b.getUploaderController(j);d=g.getMessageHandler();j.imageContainerSupport.bindImageContainer(b.getContainer(),j);b.refreshWithLatestImages(f)},refresh:function(i){b.refreshWithLatestImages(f,i)},getImageContainer:function(){return b.getContainer()},clearErrors:function(){d.clearMessages()},displayErrors:function(){d.displayErrors()},setUploadInProgress:function(i,j){g.setUploadInProgress(i,j)}},f=e(a);Confluence.Editor.ImageDialog.panelComponent.push(a)});