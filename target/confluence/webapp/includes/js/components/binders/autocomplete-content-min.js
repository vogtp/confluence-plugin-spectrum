(function(b){var a=function(f){if(!f||!f.group){throw new Error("Invalid JSON format")}var e=[];for(var g=0,h=f.group.length;g<h;g++){e.push(f.group[g].result)}return e};var d=function(p,i,f,g){var o=b(p),t="data-autocomplete-content-bound";if(o.attr(t)){return}if(typeof i=="string"){i=[i]}o.attr(t,"true").attr("autocomplete","off");var q=i.join(","),h=o.attr("data-max")||10,m=o.attr("data-alignment")||"left",l=o.attr("data-spacekey"),k=o.attr("data-none-message"),n=o.attr("data-search-link-message"),s=o.attr("data-template")||f,e=o.attr("data-target"),j=o.attr("data-dropdown-target"),r=null;if(j){r=b(j)}else{r=b("<div></div>");o.after(r)}r.addClass("aui-dd-parent autocomplete");o.focus(function(){l=o.attr("data-spacekey")});o.quicksearch(AJS.REST.getBaseUrl()+"search/name.json",null,{onShow:function(){o.trigger("open.autocomplete-content",{contentTypes:i})},makeParams:function(v){var u={"max-results":h,pageSize:h,type:q,query:v};if(l){u.spaceKey=l}return u},dropdownPlacement:function(u){r.append(u)},makeRestMatrixFromData:a,addDropdownData:function(v){if(!v.length){if(k){v.push([{name:k,className:"no-results",href:"#"}])}}if(n){var w=AJS.escapeHtml(o.val());var u=AJS.format(n,w);v.push([{className:"search-for",name:u,href:"#"}])}return v},ajsDropDownOptions:{alignment:m,displayHandler:g,selectionHandler:function(x,v){AJS.debug("autocomplete-content: ajsDropDownOptions.selectionHandler");if(v.find(".search-for").length){o.trigger("selected.autocomplete-content",{contentTypes:i,searchFor:o.val()});return}if(v.find(".no-results").length){AJS.log("no results selected");this.hide();x.preventDefault();return}var u=v.data("properties");o.val(AJS.template(s).fillHtml(u.restObj));if(e){var w=AJS.template(f).fillHtml(u.restObj);b(e).val(w)}o.trigger("selected.autocomplete-content",{contentTypes:i,content:u.restObj,selection:v});this.hide();x.preventDefault()}}})};Confluence.Binder.autocompleteSpace=function(e){e=e||document.body;b("input.autocomplete-space",e).each(function(){d(this,["spacedesc","personalspacedesc"],"{name}",function(f){return f.name})})};Confluence.Binder.autocompleteAttachment=function(e){e=e||document.body;b("input.autocomplete-attachment",e).each(function(){d(this,"attachment","{fileName}",function(f){var g=(f.restObj&&f.restObj.fileName)||f.name;if(f.restObj&&f.restObj.space&&f.restObj.space.title){g+=" ("+f.restObj.space.title+")"}return g})})};var c=function(e){return(e.restObj&&e.restObj.title&&AJS.escapeHtml(e.restObj.title))||e.name};Confluence.Binder.autocompletePage=function(e){e=e||document.body;b("input.autocomplete-page",e).each(function(){d(this,"page","{title}",c)})};Confluence.Binder.autocompleteBlogpost=function(e){e=e||document.body;b("input.autocomplete-blogpost",e).each(function(){d(this,"blogpost","{title}",c)})};Confluence.Binder.autocompleteConfluenceContent=function(e){e=e||document.body;b("input.autocomplete-confluence-content",e).each(function(){d(this,["page","blogpost"],"{title}",c)})};Confluence.Binder.autocompleteSearch=function(e){e=e||document.body;b("input.autocomplete-search",e).each(function(){d(this,[],"{title}",c)})}})(AJS.$);