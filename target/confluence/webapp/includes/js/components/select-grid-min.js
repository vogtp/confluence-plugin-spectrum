(function(c){AJS.SelectGrid=AJS.Group.extend({init:function(e){this.type=this.type||"SelectGrid";this._super();var f=c(Confluence.Templates.SelectGrid.gridOutline());var g=f.find("thead tr");c(e.columns).each(function(h,j){var k=AJS("th").addClass(j.getClassName()).text(j.heading);g.append(k)});this.gridContainer=c(e.gridContainer).append(f);this.getRowId=e.getRowId;this.table=f;this.columns=e.columns;this.selectionCallback=e.selectionCallback;this.body=f.find("tbody");this.body.delegate("a","click",function(h){h.preventDefault()});this.dontShiftFocus=e.dontShiftFocus||function(){}},keys:{up:function(f){if(!this.table.is(":visible")||this.dontShiftFocus()){return}this.shiftFocus(-1);f.preventDefault()},down:function(f){if(!this.table.is(":visible")||this.dontShiftFocus()){return}this.shiftFocus(1);f.preventDefault()}},_addRow:function(h,g,e,i){if(c.isFunction(e)){i=e;e=false}e?this.body.prepend(h):this.body.append(h);var f=new b({row:h,data:g,callback:i,getRowId:this.getRowId,selectionCallback:i});this.addItem(f);return f},clear:function(){this.removeAllItems();this.body.children().remove()},_addRows:function(g,e){var f=this;var h=[];c(g).each(function(j,k){var l=a(k,f.columns);l.attr("data-id",f.getRowId(k));h.push(f._addRow(l,k,e,f.selectionCallback))});return h},update:function(e){this.clear();if(!e||!e.length){AJS.debug("SelectGrid.update called with no data, returning.");return}this._addRows(e);this.prepareForInput()},prependAndSelect:function(f,e){if(!f||!f.length){AJS.debug("SelectGrid.prependAndSelect called with no data, returning.");return}var g=this._addRows(f,true);g[e||0].selectRow()},findItem:function(g){for(var e=0;e<this.items.length;e++){var f=this.items[e].getRowId();if(f==g){return this.items[e]}}AJS.debug("SelectGrid.findItem didn't find item, returning null.");return null},select:function(f){var e=this.findItem(f);e&&e.selectRow()},selectIndex:function(e){e=e||0;if(this.items[e]){this.items[e].selectRow()}else{AJS.debug("SelectGrid.selectIndex couldn't select row with index "+e+", not found")}},show:function(){this.gridContainer.removeClass("hidden")},hide:function(){this.gridContainer.addClass("hidden")},isVisible:function(){return !this.gridContainer.hasClass("hidden")}});var b=AJS.Control.extend({init:function(e){this.type="SelectableRow";this.$row=AJS.$(e.row);this.$row.data("properties",e.data);this.getRowId=function(){return e.getRowId(e.data)};this.selectionCallback=e.selectionCallback;this._assignEvents("element",this.$row);this._assignEvents("instance",this);AJS.debug("SelectableRow initialized")},_events:{instance:{focus:function(f){var g=this.$row;g.addClass("selected");this.selectionCallback(g,g.data("properties"))},blur:function(f){this.$row.removeClass("selected")}},element:{click:function(){this.trigger("focus")}}},selectRow:function(){this.trigger("focus")}});var d=function(f,e){return{outerClass:e.getClassName(f)||"",href:e.getHref&&e.getHref(f)||"",innerClass:e.getInnerClass&&e.getInnerClass(f)||"",title:e.getTitle&&e.getTitle(f)||"",text:e.getText(f)||""}};var a=function(i,h){var j,g,f,e;j=AJS("tr");c(h).each(function(k,l){g=d(i,l);f=g.href?"cellWithLink":"cellWithoutLink";e=Confluence.Templates.SelectGrid[f](g);j.append(e)});return j};AJS.SelectGrid.Column=function(g){var e=function(){return g.className||(g.key+"-field")},f=function(h){return h[g.key]};return{key:g.key,heading:g.heading,getClassName:g.getClassName||e,getHref:g.getHref,getInnerClass:g.getInnerClass,getTitle:g.getTitle,getText:g.getText||f}}})(AJS.$);