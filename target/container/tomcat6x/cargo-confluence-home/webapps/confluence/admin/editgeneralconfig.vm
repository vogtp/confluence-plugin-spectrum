#* @vtlvariable name="action" type="com.atlassian.confluence.admin.actions.GeneralConfigurationAction" *#
<html>
	<head>
		<title>$action.getText("title.general.config")</title>
        <content tag="selectedWebItem">generalconfiguration</content>
    </head>
	<body>
        #requireResource("confluence.web.resources:aui-forms")
        #requireResource("confluence.sections.admin.generalconfig:resources")

        #parse ( "/template/includes/actionerrors.vm" )

        #if($editMode)
            #set($formAction="doeditgeneralconfig.action")
        #else
            #set($formAction="editgeneralconfig.action")
        #end

        <form method="POST" class="aui long-label" name="editgeneralconfig" action="$formAction">
            #form_xsrfToken()

            <div class="hidden parameters">
                <input type="hidden" id="editMode" value="$editMode">
            </div>

            ##Site Configuration
            #if(!$editMode)<a href="$req.contextPath/admin/editgeneralconfig.action" class="edit-link">$action.getText("edit.name")</a>#end
            <h2>$action.getText("sub.title.site")</h2>
            <p>$action.getText("sub.title.site.description")</p>
            #bodytag( "TextField" "label='site.title'" "name='siteTitle'" "value=siteTitle" "theme='aui'")
                #param("longField" "true")
            #end
            <div class="description description-textbox">
                $i18n.getText('generalconfig.site.title.description')
            </div>

            <div id="urlWarning" class="hidden warning-message">
                $action.getText("warning.domain.name.match") <a href="$action.getText('url.confluence.atlassian')/display/CONFKB/Various+issues+Caused+when+Server+Base+URL+does+not+Match+the+URL+used+to+access+Confluence"> $action.getText("warning.domain.name.match.kb")</a>
            </div>
            #bodytag( "TextField" "id=editbaseurl" "label='domain.name'" "name='domainName'" "value=domainName" "disabled=!$systemAdmin" "theme='aui'")
                #param("longField" "true")
            #end
            <div class="description description-textbox">
                $i18n.getText('server.base.url.description')
                #doc("help.configure.server.URL" "$action.getText('more.about.server.base.url')")
            </div>

            #tag( "Select" "label='site.homepage'" "name='siteHomePage'" "list=siteHomePages" "listKey=key" "listValue=value" "theme='aui'")
            <div class="description description-textbox">
                $i18n.getText('generalconfig.site.homepage.description')
            </div>


            #if ($editMode)
                #tag( "Textarea" "label='site.welcome.message'" "name='siteWelcomeMessage'" "rows=5" "cols=72"  "theme='aui'")
                <div class="description description-textbox">
                    $action.getText('site.welcome.message.description')
                    #hint("input.accepts.wiki.markup")
                    #doc('help.editing.site.welcome.message' "$i18n.getText('more.about.site.welcome.message')")
                </div>
            #else
                <div class="field-group">
                    <label>$action.getText("site.welcome.message")</label>
                    <div class="welcome-message">$!action.renderedSiteWelcomeMessage</div>
                </div>
                <div class="description description-textbox">
                    $i18n.getText('site.welcome.message.description')
                </div>
            #end

            #if ($editMode)
                #tag( "Textarea" "label='site.custom.contact.admin.message'" "name='customContactAdminMessage'" "rows=5" "cols=72" "theme='aui'")
                <div class="description description-textbox">
                    $i18n.getText('site.custom.contact.admin.message.description')
                    #hint("input.accepts.wiki.markup")
                </div>
            #else
                <div class="field-group">
                    <label>$action.getText("site.custom.contact.admin.message")</label>
                    <div>$!action.renderedCustomErrorMessage</div>
                </div>
                <div class="description description-textbox">
                    $i18n.getText('site.custom.contact.admin.message.description')
                </div>
            #end

            #tag( "Component" "label='site.custom.contact.admin.form'" "name='showContactAdministratorsForm'" "theme='aui'" "value=showContactAdministratorsForm" "template='onofflist.vm'")
            <div class="description description-checkbox">
                $i18n.getText('site.custom.contact.admin.form.description')
            </div>

            ##Feature Settings
            #if($editMode)
                <a name="features"></a>
            #else
                <a href="$req.contextPath/admin/editgeneralconfig.action#features" class="edit-link">$action.getText("edit.name")</a>
            #end
            <h2>$action.getText("sub.title.features")</h2>
            #if ($systemAdmin)
                <p>$action.getText("sub.title.features.description", [ "$req.contextPath/plugins/servlet/upm" ])</p>
            #end
            #tag( "Component" "label='view.space.goes.to.browse.space'" "name='viewSpaceGoesToSpaceSummary'" "value=viewSpaceGoesToSpaceSummary" "theme='aui'" "template='onofflist.vm'")
            <div class="description description-checkbox">
                $i18n.getText('view.space.goes.to.summary.description')
            </div>
            #tag( "Component" "label='allow.threaded.comments'" "name='allowThreadedComments'" "value=allowThreadedComments" "template='onofflist.vm'" "theme='aui'")
            <div class="description description-checkbox">
                $i18n.getText('threaded.comments.description')
            </div>

            #tag( "Component" "label='allow.trackbacks'" "name='allowTrackbacks'" "value=allowTrackbacks" "template='onofflist.vm'" "theme='aui'")
            <div class="description description-checkbox">
                $i18n.getText('trackback.description')
            </div>
            #tag( "Component" "label='allow.remoteapi'" "name='allowRemoteApi'" "value=allowRemoteApi" "template='onofflist.vm'" "disabled=!$systemAdmin" "theme='aui'")
            <div class="description description-checkbox">
                $i18n.getText('remote.api.description')
            </div>
            #tag( "Component" "label='gzip.response.encoding'" "name='gzipResponseEncoding'" "value=gzipResponseEncoding" "template='onofflist.vm'" "theme='aui'")
            #tag( "Component" "label='open.search'" "name='enableOpenSearch'" "value=enableOpenSearch" "theme='aui'" "template='onofflist.vm'")
            #tag( "Component" "label='javascript.top'" "name='enableJavascriptTop'" "value=enableJavascriptTop" "theme='aui'" "template='onofflist.vm'")
            <div class="description description-checkbox">
                $i18n.getText('javascript.top.description')
            </div>
            #if ($editMode)
            #set($didYouMeanDesc = $action.getText('did.you.mean.to.enable', ["<a href='${req.contextPath}/admin/search-indexes.action'>", '</a>']))
            #end
            #bodytag ("Component" "label='did.you.mean.only.english.supported'" "name='enableDidYouMean'" "value=enableDidYouMean" "template='onofflist.vm'" "theme='aui'")
                #param("description" "$!didYouMeanDesc")
            #end
            #if ($action.didYouMeanIndexExists()) <input type="hidden" id="dymIndexExists" value="true"/> #end

            <div class="field-group">
                #if($editMode)
                    #bodytag( "Component" "label='draft.save.interval'" "name='draftSaveIntervalMinutes'" "value=draftSaveIntervalMinutes" "template='text-inline.vm'" "theme='aui'")
                        #param("shortField" "true")
                        #param("inlineText" "$action.getText('draft.save.interval.mins')")
                    #end
                    #bodytag( "Component" "label=''" "name='draftSaveIntervalSeconds'" "value=draftSaveIntervalSeconds" "template='text-inline.vm'" "theme='aui'")
                        #param("shortField" "true")
                        #param("inlineText" "$action.getText('draft.save.interval.secs')")
                    #end
                #else
                    <label for="draftSaveIntervalMinutes">$action.getText("draft.save.interval")</label>
                    <span id="draftSaveIntervalMinutes" class="field-value">$!action.niceDraftSaveInterval</span>
                #end
            </div>
            <div class="description description-textbox">
                $i18n.getText('draft.save.interval.description')
            </div>

            <fieldset class="group">
                <legend><span>$action.getText("quick.nav")</span></legend>
                #tag( "Component" "label='enable.name'" "name='enableQuickNav'" "value=enableQuickNav" "theme='aui'" "template='onofflist-include.vm'")
                ## Not normal AUI form markup, but the maxSimultaneousQuickNavRequests field needs to be associated with the above checkbox
                #if($editMode)
                    <input name="maxSimultaneousQuickNavRequests" id="maxSimultaneousQuickNavRequests" value="$maxSimultaneousQuickNavRequests" class="text short-field " type="text">
                    <span  class="inline-text">$action.getText('quick.nav.max.simultaneous.requests')</span>
                #else
                    #if($action.enableQuickNav)
                        <label for="maxSimultaneousQuickNavRequests">($action.getText("quick.nav.max.simultaneous.requests"): $!action.maxSimultaneousQuickNavRequests)</label>
                    #end
                #end
            </fieldset>

            ##Formatting and International Settings
            #if($editMode)
                <a name="formatting"></a>
            #else
                <a href="$req.contextPath/admin/editgeneralconfig.action#formatting" class="edit-link">$action.getText("edit.name")</a>
            #end

            <h2>$action.getText("sub.title.formatting")</h2>
            <p>
                $i18n.getText("sub.title.formatting.description", [ "$req.contextPath/admin/configurelanguage.action" ])
                $i18n.getText('formatting.description')
            </p>
            #tag( "Select" "label='indexing.language'" "name='indexingLanguage'" "list=indexingLanguages" "listKey=key" "listValue=value" "theme='aui'" )
            #tag( "TextField" "label='defaultEncoding'" "name='defaultEncoding'" "value=defaultEncoding" "theme='aui'" )
            #tag( "TextField" "label='defaultTimeFormatterPattern'" "name='defaultTimeFormatterPattern'" "value=defaultTimeFormatterPattern" "theme='aui'" )
            #tag( "TextField" "label='defaultDateTimeFormatterPattern'" "name='defaultDateTimeFormatterPattern'" "value=defaultDateTimeFormatterPattern" "theme='aui'" )
            #tag( "TextField" "label='defaultDateFormatterPattern'" "name='defaultDateFormatterPattern'" "value=defaultDateFormatterPattern" "theme='aui'" )
            #tag( "TextField" "label='defaultLongNumberFormatterPattern'" "name='defaultLongNumberFormatterPattern'" "value=defaultLongNumberFormatterPattern" "theme='aui'" )
            #tag( "TextField" "label='defaultDecimalNumberFormatterPattern'" "name='defaultDecimalNumberFormatterPattern'" "value=defaultDecimalNumberFormatterPattern" "theme='aui'")

            ##Attachment Settings
            #if($editMode)
                <a name="attachments"></a>
            #else
                <a href="$req.contextPath/admin/editgeneralconfig.action#attachments" class="edit-link">$action.getText("edit.name")</a>
            #end
            <h2>$action.getText("sub.title.attachment")</h2>
            #if ($systemAdmin)
                <p>
                    $i18n.getText("sub.title.attachment.description", [ "$req.contextPath/admin/attachmentstoragesetup.action" ])
                </p>
            #end
            #if ($editMode)
                #set($attachmentValue = $action.attachmentMaxSize)
            #else
                #set($attachmentValue = $action.niceAttachmentMaxSize)
            #end
            #bodytag( "TextField" "label='attachment.max.size'" "name='attachmentMaxSize'" "value='$attachmentValue'" "theme='aui'" )
                #param("shortField" "true")
                #param("inlineText" "$action.getText('attachment.maximum.size.unit')")
            #end
            <div class="description description-textbox">
                $i18n.getText('attachment.maximum.size.description')
            </div>
            #bodytag( "TextField" "label='attachment.max.upload'" "name='maxAttachmentsInUI'" "value=maxAttachmentsInUI" "theme='aui'" )
                #param("shortField" "true")
            #end

            ##Connection Timeouts
            #if($editMode)
                <a name="timeouts"></a>
            #else
                <a href="$req.contextPath/admin/editgeneralconfig.action#timeouts" class="edit-link">$action.getText("edit.name")</a>
            #end
            <h2>$action.getText('timeouts.heading')</h2>
            #tag( "Component" "label='timeouts.enabled'" "name='connectionsEnabled'" "value=connectionsEnabled" "theme='aui'" "template='onofflist.vm'" "disabled=!$systemAdmin")
            #bodytag( "TextField" "id=connectionTimeouts" "label='timeouts.connectionTimeout'" "name='connectionTimeout'" "value=connectionTimeout" "disabled=!$systemAdmin" "theme='aui'")
                #param("shortField" "true")
            #end
            #bodytag( "TextField" "id=socketTimeouts" "label='timeouts.socketTimeout'" "name='socketTimeout'" "value=socketTimeout" "disabled=!$systemAdmin" "theme='aui'" )
                #param("shortField" "true")
            #end

            ## Buttons
            #bodytag( "Submit" "theme='aui'" )
                #param ("submitValue" "$action.getText('update.name')")
                #param ("cancelValue" "$action.getText('cancel.name')")
            #end
        </form>

		#parse("/breadcrumbs.vm")
	</body>
</html>
