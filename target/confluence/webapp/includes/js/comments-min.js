AJS.toInit(function(f){if(!f("#comments-section").length){return}if(AJS.isIE6){f(".logo.anonymous").each(function(){var g=document.createElement("div");g.className="replacement";AJS.applyPngFilter(g,this.src);f(this).replaceWith(g)});f(".comment-actions .comment-permalink a").each(function(){f(this).addClass("filtered");var h=f(this).css("background-image").replace(/^url\(\"?|\"?\)$/g,"");var g=h.replace("light","dark");AJS.applyPngFilter(this,h);this.style.cursor="pointer";this.style.background="none";f(this).hover(function(){AJS.applyPngFilter(this,g)},function(){AJS.applyPngFilter(this,h)})})}f("#comments-section .comment:odd").addClass("odd");f(".comment-action-remove a").click(function(){if(confirm(AJS.I18n.getText("remove.comment.confirmation.message"))){this.href=this.href+"&confirm=yes";return true}return false});var e=Confluence.storageManager("comments");var d=function(g){f("#page-comments").toggleClass("hidden",!g);f(".comments-show-hide").toggleClass("comments-showing",g);f(".icon.comments-show-hide").toggleClass("icon-section-closed",!g);f(".icon.comments-show-hide").toggleClass("icon-section-opened",g);e.setItem("show",g)};if(AJS.Meta.getBoolean("show-comments")){d(true)}else{var b=e.getItem("show");if(b!=null){d(b=="true")}}f(".comments-show-hide").click(function(){d(!f(this).hasClass("comments-showing"));return false});var c=f("#addcomment.comment-text"),a=f("#comments-text-editor textarea");a.focus(function(){c.addClass("active")}).blur(function(){if(!f.trim(a.val()).length){c.removeClass("active")}}).bind("reset.default-text",function(){c.removeClass("active")});f("form[name='textcommentform']").submit(function(){var g=a.val();if(!f.trim(g)){alert(AJS.I18n.getText("content.empty"));return false}return true});f("#add-comment-rte").click(function(){if(!a.hasClass("placeholded")){e.setItem("text-comment",f.trim(a.val()))}});if(f("#addcomment #rte").length){AJS.bind("init.rte",function(i,h){var g=e.getItem("text-comment");if(g){h.editor.setContent(g);e.setItem("text-comment","")}})}});