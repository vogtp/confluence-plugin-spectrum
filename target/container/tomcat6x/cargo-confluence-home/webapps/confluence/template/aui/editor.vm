#* TODO Update this doc
This is a template for the RTE editor.

-- Required Parameters:
--   * $formname       - the name of the form the text area is in
--   * $name           - name of the textarea input that gets submitted
--   * $contenType     - the type of the content the textarea will be displayed for.
--   * $contentId      - the id of the content the textarea will be displayed for. Use 0 for new pages.
                         If not specified, it will fallback to using the page or draft id.

-- Optional Parameters:
--   * $heartbeat      - if 'true' and the editor's ajax is enabled, heartbeats are used - otherwise false
--   * $saveDrafts     - if 'true' and the editor's ajax is enabled, drafts are saved - otherwise false
*#



#requireResourcesForContext("editor")
#requireResourcesForContext("macro-browser")

#set($useHints = $parameters.useHints)
#set($useWatch = $parameters.useWatch)
#set($useRestrictions = $parameters.useRestrictions)
#set($useVersionComment = $parameters.useVersionComment)
#set($useMinorEdit = $parameters.useMinorEdit)
#set($minEditorHeight = $parameters.minEditorHeight)

#if ($parameters.heartbeat && $parameters.heartbeat == "true")
    #set( $heartbeat = true)
#else
    #set ( $heartbeat = false )
#end

#if ($parameters.saveDrafts && $parameters.saveDrafts == "true")
    #set( $saveDrafts = true)
#else
    #set ( $saveDrafts = false )
#end

#if ($action.wysiwygContent)
    #set($wysiwygContent = $action.wysiwygContent)
#else
    #set($wysiwygContent = $parameters.wysiwygContent)
#end

#if ($parameters.contentId)
    #set($contentId = $parameters.contentId)
#else
    #if ($pageId.toString() == "0" && $draft.id)
        #set($contentId = $draft.id)
    #else
        #set($contentId = $pageId)
    #end
#end

#if ($parameters.contentType == "page" || $parameters.contentType == "blogpost")
    #set($usePageLayouts = true)
#end

#if($viewPermissionsUsers || $editPermissionsUsers || $viewPermissionsGroups || $editPermissionsGroups)
    #set ($hasRestrictions = true)
#end

<script type="text/x-template" title="editor-css">
    $webResourceManager.getEditorCssResources($spaceKey)
</script>

    #set ($context = {  "id": "rte",
    "fullscreen": $parameters.fullscreen,
    "minEditorHeight": $parameters.minEditorHeight,
    "usePageLayouts": $usePageLayouts,
    "useHints": $parameters.useHints,
    "useWatch": $parameters.useWatch,
    "useVersionComment": $parameters.useVersionComment,
    "versionComment": $action.versionComment,
    "useMinorEdit": $parameters.useMinorEdit,
    "shouldResize": $parameters.shouldResize,
    "content": $wysiwygContent,
    "versionMismatch": $versionMismatch,
    "i18n": $action.i18n,
    "req": $req,
    "locale": $action.locale,
    "webResourceManager": $webResourceManager,
    "webInterfaceManager": $webInterfaceManager,
    "webInterfaceContext": $webInterfaceContext,
    "textareaName": "wysiwygContent",
    "fieldErrors": $fieldErrors,
    "userWatchingOwnContent" : $action.isUserWatchingOwnContent(),
    "useDatePicker": $parameters.useDatePicker,
    "postingDate": $parameters.postingDate,
    "darkFeatures": $darkFeatures
    })

    #webPanelForLocation("atl.editor" $context)
    ## identity of the content
    #putMetadata('content-id', $contentId)
    #putMetadata('content-type', $parameters.contentType)
    #putMetadata('draft-type', $parameters.draftType)
    #putMetadata('new-page', $draft.newPage)
    #putMetadata('num-attachments', $helper.getNumberOfAttachments())
    #putMetadata('num-labels', $helper.getNumberOfLabels())
    #putMetadata('attachment-source-content-id', $action.attachmentSourceContent.id)
   ## configuration for the macro and link browsers (and probably the image browser too)
    #putMetadata('can-attach-files', $permissionHelper.canAttachFile($action.remoteUser, $action.attachmentSourceContent))

    ## configuration
    #putMetadata('heartbeat', $heartbeat)
    #putMetadata('save-drafts', $saveDrafts)
    #putMetadata('min-editor-height', $minEditorHeight)
    #putMetadata('editor-mode', $action.mode)
    #putMetadata('action-locale', $action.locale)
    #putMetadata('editor-plugin-resource-prefix', $webResourceHelper.getStaticResourcePrefix($action.editorVersion))

    ## used by tinymce
    #if ($parameters.formname)
    #putMetadata('form-name', $parameters.formname)
#end

#if($useRestrictions)
## The actual data submitted on page save.

<div id="hidden-permission-fields" class="hidden">
    <input id="viewPermissionsUsers" type="text" name="viewPermissionsUsers" value="$!viewPermissionsUsers">
    <input id="editPermissionsUsers" type="text" name="editPermissionsUsers" value="$!editPermissionsUsers">
    <input id="viewPermissionsGroups" type="text" name="viewPermissionsGroups" value="$!viewPermissionsGroups">
    <input id="editPermissionsGroups" type="text" name="editPermissionsGroups" value="$!editPermissionsGroups">
</div>
#end
## Templates
#parse("/template/includes/table-dialog-templates.vm")
#parse("/labels/labels-dialog.vm")

